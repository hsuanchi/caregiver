<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¦–è¦ºåŒ–ç‡Ÿé¤Šç™¾ç§‘ | NutriWiki</title>
    
    <!-- å¼•å…¥ Tailwind CSS (å¿«é€Ÿæ’ç‰ˆèˆ‡ç¾åŒ–) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- å¼•å…¥ Chart.js (è³‡æ–™è¦–è¦ºåŒ–åœ–è¡¨) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- å¼•å…¥ Google Fonts (æå‡é–±è®€é«”é©—) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- å¼•å…¥ FontAwesome (åœ–ç¤º) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        /* è‡ªå®šç¾©éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Header Component Container -->
    <div id="header-component"></div>

    <!-- 2. æœå°‹èˆ‡ Hero å€å¡Š (ç™½è‰²æ¥µç°¡é¢¨æ ¼ + åˆ†é¡ç¯©é¸) -->
    <header class="bg-white text-gray-800 py-12 md:py-20 relative overflow-hidden shadow-sm">
        <!-- è£é£¾èƒŒæ™¯åœ–ç¤º (æ”¹ç‚ºæ·¡ç°è‰²) -->
        <div class="absolute top-0 right-0 opacity-5 transform translate-x-10 -translate-y-10 pointer-events-none">
            <i class="fa-solid fa-carrot text-9xl text-gray-400"></i>
        </div>
        
        <div class="max-w-3xl mx-auto px-4 text-center relative z-10">
            <h1 class="text-3xl md:text-4xl font-bold mb-4 tracking-tight text-gray-900">
                <span class="text-green-600">æ•¸æ“š</span> è½‰åŒ–ç‚ºæ‚¨çš„å¥åº·æ±ºç­–
            </h1>
            <p class="text-gray-500 mb-8 text-lg">å¸¸è¦‹ç¾é£Ÿè¦–è¦ºåŒ–ç‡Ÿé¤Šè³‡æ–™åº«ï¼Œè¼¸å…¥é£Ÿæç«‹å³æŸ¥è©¢ã€‚</p>
            
            <!-- æœå°‹æ¡†å€å¡Š -->
            <div class="relative max-w-lg mx-auto z-30">
                <div class="relative">
                    <input type="text" id="searchInput" placeholder="è©¦è©¦çœ‹ï¼šé…ªæ¢¨ã€é›èƒ¸è‚‰ã€é®­é­š..." 
                        class="w-full pl-12 pr-4 py-4 rounded-full shadow-md border border-gray-200 bg-gray-50 text-gray-800 focus:bg-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                        autocomplete="off">
                    <i class="fa-solid fa-search absolute left-5 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
                
                <!-- æœå°‹å»ºè­°ä¸‹æ‹‰é¸å–® (é è¨­éš±è—) -->
                <div id="searchResults" class="hidden absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-xl overflow-y-auto max-h-80 text-left text-gray-800 border border-gray-100 no-scrollbar">
                    <!-- JS å‹•æ…‹ç”Ÿæˆçµæœ -->
                </div>
            </div>

            <div class="mt-6 flex justify-center flex-wrap gap-2 text-sm opacity-80">
                <span class="text-gray-400 text-xs py-1">ç†±é–€æœå°‹ï¼š</span>
                <button class="quick-search-btn text-green-600 hover:text-green-800 underline decoration-green-300 decoration-2 underline-offset-2 transition" data-food="avocado">é…ªæ¢¨</button>
                <button class="quick-search-btn text-green-600 hover:text-green-800 underline decoration-green-300 decoration-2 underline-offset-2 transition" data-food="chicken">é›èƒ¸è‚‰</button>
                <button class="quick-search-btn text-green-600 hover:text-green-800 underline decoration-green-300 decoration-2 underline-offset-2 transition" data-food="pearl_milk_tea">çå¥¶</button>
            </div>

            <!-- åˆ†é¡ç¯©é¸å€å¡Š (Category Filter) -->
            <div class="mt-8">
                <p class="text-xs text-gray-400 mb-3 uppercase tracking-wider font-bold">æŒ‰åˆ†é¡ç€è¦½</p>
                <div id="categoryFilters" class="flex flex-wrap justify-center gap-2 max-w-2xl mx-auto">
                    <!-- JS å°‡æœƒå‹•æ…‹ç”Ÿæˆåˆ†é¡æŒ‰éˆ• -->
                </div>
            </div>

            <!-- å¿«é€Ÿæ¨™ç±¤ -->
           
        </div>
    </header>

    <!-- 3. ä¸»è¦å…§å®¹å€ (Main Content) -->
    <main class="max-w-6xl mx-auto px-4 py-8">
        
        <!-- åˆ†é¡ç¯©é¸çµæœå®¹å™¨ (é è¨­éš±è—) -->
        <div id="categoryResultsContainer" class="hidden grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-8">
            <!-- JS å‹•æ…‹ç”Ÿæˆåˆ†é¡çµæœå¡ç‰‡ -->
        </div>

        <!-- é£Ÿç‰©è©³æƒ…å¡ç‰‡ -->
        <div id="foodDetail" class="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden transition-all duration-300">
            
            <!-- æ¨™é¡Œèˆ‡ä»½é‡æ§åˆ¶å€ -->
            <div class="p-6 md:p-8 border-b border-gray-100 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div class="flex items-center gap-4">
                    <div id="foodIcon" class="w-16 h-16 rounded-2xl bg-green-50 flex items-center justify-center text-4xl shadow-sm border border-green-100">
                        ğŸ¥‘
                    </div>
                    <div>
                        <h2 id="foodName" class="text-3xl font-bold text-gray-800">é…ªæ¢¨ (Avocado)</h2>
                        <span id="foodCategory" class="text-sm text-green-700 bg-green-100 px-2 py-1 rounded-md font-medium">æ²¹è„‚èˆ‡å …æœç¨®å­é¡</span>
                    </div>
                </div>

                <!-- ä»½é‡æ›ç®—å™¨ -->
                <div class="bg-gray-100 p-1 rounded-lg flex text-sm font-medium">
                    <button class="portion-btn px-4 py-2 rounded-md shadow-sm bg-white text-green-700 transition" data-mult="1" id="btn-100g">100g (æ¨™æº–)</button>
                    <button class="portion-btn px-4 py-2 rounded-md text-gray-500 hover:text-gray-700 transition" data-mult="1.5" id="btn-serving">1 é¡† (å»ç±½ç´„ 150g)</button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-0 lg:gap-8">
                
                <!-- å·¦å´ï¼šæ ¸å¿ƒæ•¸æ“šèˆ‡åœ–è¡¨ -->
                <div class="lg:col-span-1 p-6 md:p-8 bg-gray-50 border-r border-gray-100">
                    <h3 class="text-lg font-bold text-gray-700 mb-6 flex items-center">
                        <i class="fa-solid fa-chart-pie mr-2 text-green-500"></i> ç‡Ÿé¤Šåˆ†ä½ˆé›·é”
                    </h3>
                    <div class="relative w-full aspect-square max-w-[300px] mx-auto">
                        <canvas id="nutritionRadar"></canvas>
                    </div>
                    <div class="mt-6 text-center">
                        <div class="text-4xl font-extrabold text-gray-800" id="caloriesDisplay">160 <span class="text-base font-normal text-gray-500">kcal</span></div>
                        <div class="text-sm text-gray-500">ç¸½ç†±é‡</div>
                    </div>
                </div>

                <!-- å³å´ï¼šè©³ç´°æ•¸æ“š (è³‡è¨Šåœ–è¡¨åŒ–) -->
                <div class="lg:col-span-2 p-6 md:p-8">
                    <h3 class="text-lg font-bold text-gray-700 mb-6 flex items-center">
                        <i class="fa-solid fa-list-check mr-2 text-green-500"></i> ç‡Ÿé¤Šç´ å„€è¡¨æ¿
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-8">
                        
                        <!-- å·¨é‡ç‡Ÿé¤Šç´  (Macro) -->
                        <div class="space-y-5">
                            <h4 class="text-sm font-semibold text-gray-400 uppercase tracking-wider">ä¸‰å¤§ç‡Ÿé¤Šç´ </h4>
                            
                            <!-- è›‹ç™½è³ª -->
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-700">è›‹ç™½è³ª (Protein)</span>
                                    <span class="text-sm font-bold text-gray-900" id="val-protein">2g</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5">
                                    <div id="bar-protein" class="bg-blue-500 h-2.5 rounded-full" style="width: 10%"></div>
                                </div>
                            </div>

                            <!-- è„‚è‚ª -->
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-700">ç¸½è„‚è‚ª (Fat)</span>
                                    <span class="text-sm font-bold text-gray-900" id="val-fat">14.7g</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5">
                                    <div id="bar-fat" class="bg-yellow-400 h-2.5 rounded-full" style="width: 70%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1"><i class="fa-solid fa-circle-info text-blue-400"></i> å¯Œå«å–®å…ƒä¸é£½å’Œè„‚è‚ªé…¸ï¼Œå°å¿ƒè¡€ç®¡æœ‰ç›Šã€‚</p>
                            </div>

                            <!-- ç¢³æ°´åŒ–åˆç‰© -->
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-700">ç¢³æ°´åŒ–åˆç‰© (Carbs)</span>
                                    <span class="text-sm font-bold text-gray-900" id="val-carbs">8.5g</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5">
                                    <div id="bar-carbs" class="bg-green-500 h-2.5 rounded-full" style="width: 25%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- å¾®é‡ç‡Ÿé¤Šç´ èˆ‡ç‰¹å¾µ (Micro & Highlights) -->
                        <div class="space-y-5">
                            <h4 class="text-sm font-semibold text-gray-400 uppercase tracking-wider">é‡é»å¾®é‡å…ƒç´ </h4>
                            
                            <!-- é‰€ -->
                            <div class="flex items-center p-3 bg-blue-50 rounded-lg border border-blue-100">
                                <div class="p-2 bg-blue-100 rounded-full text-blue-600 mr-3">
                                    <i class="fa-solid fa-bolt"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="text-sm font-medium text-gray-600">é‰€ (Potassium)</div>
                                    <div class="text-lg font-bold text-gray-800" id="val-k">485mg</div>
                                </div>
                                <div class="text-xs font-bold text-white bg-blue-500 px-2 py-1 rounded">é«˜</div>
                            </div>

                            <!-- è†³é£Ÿçº–ç¶­ -->
                            <div class="flex items-center p-3 bg-green-50 rounded-lg border border-green-100">
                                <div class="p-2 bg-green-100 rounded-full text-green-600 mr-3">
                                    <i class="fa-solid fa-seedling"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="text-sm font-medium text-gray-600">è†³é£Ÿçº–ç¶­ (Fiber)</div>
                                    <div class="text-lg font-bold text-gray-800" id="val-fiber">6.7g</div>
                                </div>
                                <div class="text-xs font-bold text-white bg-green-500 px-2 py-1 rounded">å„ª</div>
                            </div>
                        </div>

                    </div>
                    
                    <!-- çµè«–/AI Summary -->
                    <div class="mt-8 bg-gray-800 text-white p-4 rounded-xl flex gap-3 items-start shadow-md">
                        <i class="fa-solid fa-robot mt-1 text-green-400"></i>
                        <div>
                            <h5 class="font-bold text-sm text-green-400 mb-1">NutriBot çŸ­è©•ï¼š</h5>
                            <p class="text-sm leading-relaxed text-gray-300" id="ai-summary">
                                é€™æ˜¯éå¸¸å„ªè³ªçš„æ²¹è„‚ä¾†æºï¼é›–ç„¶ç†±é‡ç¨é«˜ï¼Œä½†å¯Œå«è†³é£Ÿçº–ç¶­èˆ‡é‰€é›¢å­ã€‚å»ºè­°æ­é…é›èƒ¸è‚‰é£Ÿç”¨ï¼Œé©åˆç”Ÿé…®é£²é£Ÿæˆ–å¢è‚Œæ¸›è„‚æ—ç¾¤ã€‚
                            </p>
                        </div>
                    </div>

                    <!-- æŸ¥çœ‹å®Œæ•´é é¢æŒ‰éˆ• -->
                    <div class="mt-4 text-right">
                        <a id="full-page-link" href="#" class="inline-block text-green-600 hover:text-green-800 font-medium transition-colors group">
                            æŸ¥çœ‹å®Œæ•´ç‡Ÿé¤Šåˆ†æ <i class="fa-solid fa-arrow-right ml-1 group-hover:translate-x-1 transition-transform"></i>
                        </a>
                    </div>

                </div>
            </div>
        </div>

    </main>

    <!-- Footer Component Container -->
    <div id="footer-component"></div>

    <!-- Load Website Components -->
    <script src="../food/food_data.js"></script>
    <script src="../assets/js/deus-header-component.js"></script>
    <script src="../assets/js/deus-footer-component.js"></script>

        <!-- JavaScript é‚è¼¯å€ -->
        <script>
            // --- 1. è³‡æ–™åº«å·²ç§»è‡³å¤–éƒ¨ food_data.js ---
            
            // ç‹€æ…‹ç®¡ç†
            let currentFoodKey = 'avocado';
            let currentMultiplier = 1;
            let radarChart = null;
            
            // --- 2. æ ¸å¿ƒåŠŸèƒ½å‡½æ•¸ ---
    
            document.addEventListener('DOMContentLoaded', () => {
                // Initialize Header and Footer
                const headerContainer = document.getElementById("header-component");
                if (headerContainer && window.DeusHeaderComponent) {
                  new window.DeusHeaderComponent(headerContainer).setDebug(false);
                }
                const footerContainer = document.getElementById("footer-component");
                if (footerContainer && window.DeusFooterComponent) {
                  new window.DeusFooterComponent(footerContainer).setDebug(false);
                }
    
                // åˆå§‹åŒ–åˆ†é¡æŒ‰éˆ•
                generateCategoryButtons();
                
                // ç¶å®šå¿«é€Ÿæ¨™ç±¤äº‹ä»¶
                document.querySelectorAll('.quick-search-btn').forEach(btn => {
                    btn.addEventListener('click', handleQuickSearchClick);
                });
                
                // é è¨­æ¸²æŸ“ç¬¬ä¸€ç­†é£Ÿç‰©
                const defaultFoodKey = Object.keys(foodDatabase)[0];
                currentFoodKey = defaultFoodKey;
                renderFood(currentFoodKey);
                
                // ç¶å®šä»½é‡æŒ‰éˆ•äº‹ä»¶
                document.querySelectorAll('.portion-btn').forEach(btn => {
                    btn.addEventListener('click', handlePortionClick);
                });
    
                // ç¶å®šæœå°‹æ¡†äº‹ä»¶
                const searchInput = document.getElementById('searchInput');
                const searchResults = document.getElementById('searchResults');
                
                searchInput.addEventListener('input', (e) => {
                    handleSearch(e.target.value);
                });
                
                // é»æ“Šé é¢å…¶ä»–åœ°æ–¹æ™‚éš±è—æœå°‹çµæœ
                document.addEventListener('click', (e) => {
                    // å¦‚æœé»æ“Šç›®æ¨™ä¸æ˜¯æœå°‹æ¡†ã€åˆ†é¡æŒ‰éˆ•æˆ–æœå°‹çµæœæœ¬èº«ï¼Œå‰‡é—œé–‰æœå°‹çµæœ
                    if (!e.target.closest('#searchInput') && 
                        !e.target.closest('#categoryFilters') &&
                        !e.target.closest('#searchResults')) {
                        searchResults.classList.add('hidden');
                    }
                });
            });
    
            // å‹•æ…‹ç”Ÿæˆåˆ†é¡æŒ‰éˆ•
            function generateCategoryButtons() {
                const container = document.getElementById('categoryFilters');
                const categories = [...new Set(Object.values(foodDatabase).map(item => item.category))];
                
                // Add 'All' button
                const allBtn = document.createElement('button');
                allBtn.className = 'px-3 py-1 rounded-full text-xs font-medium border border-green-500 bg-green-500 text-white transition shadow-sm';
                allBtn.innerText = 'å…¨éƒ¨';
                allBtn.addEventListener('click', () => {
                    const allFoodKeys = Object.keys(foodDatabase);
                    document.getElementById('foodDetail').classList.add('hidden');
                    document.getElementById('categoryResultsContainer').classList.remove('hidden');
                    renderCategoryResults(allFoodKeys);
                    
                    // Active state
                    document.querySelectorAll('#categoryFilters button').forEach(b => b.classList.remove('bg-green-500', 'text-white'));
                    allBtn.classList.add('bg-green-500', 'text-white');
                });
                container.appendChild(allBtn);
    
                categories.forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'px-3 py-1 rounded-full text-xs font-medium border border-gray-300 bg-white text-gray-600 hover:bg-green-50 hover:text-green-700 hover:border-green-300 transition shadow-sm';
                    btn.innerText = category;
                    btn.addEventListener('click', (e) => {
                        filterByCategory(category);
                        
                        // Active state
                        document.querySelectorAll('#categoryFilters button').forEach(b => {
                            b.classList.remove('bg-green-500', 'text-white');
                            b.classList.add('bg-white', 'text-gray-600');
                        });
                        e.currentTarget.classList.add('bg-green-500', 'text-white');
                        e.currentTarget.classList.remove('bg-white', 'text-gray-600');
                    });
                    container.appendChild(btn);
                });
            }
    
            // ä¾åˆ†é¡ç¯©é¸åŠŸèƒ½
            function filterByCategory(category) {
                const searchInput = document.getElementById('searchInput');
                const foodDetail = document.getElementById('foodDetail');
                const categoryResultsContainer = document.getElementById('categoryResultsContainer');
                
                // æ¸…ç©ºæœå°‹æ¡†ï¼Œè®“ä½¿ç”¨è€…çŸ¥é“ç¾åœ¨æ˜¯åˆ†é¡ç€è¦½æ¨¡å¼
                searchInput.value = '';
                searchInput.placeholder = `æ­£åœ¨ç€è¦½ï¼š${category}`;
    
                // ç¯©é¸ç¬¦åˆè©²åˆ†é¡çš„é£Ÿç‰©
                const results = Object.keys(foodDatabase).filter(key => {
                    return foodDatabase[key].category === category;
                });
    
                // éš±è—é£Ÿç‰©è©³æƒ…ï¼Œé¡¯ç¤ºåˆ†é¡çµæœ
                foodDetail.classList.add('hidden');
                categoryResultsContainer.classList.remove('hidden');
    
                renderCategoryResults(results);
            }
    
            // NEW: æ¸²æŸ“åˆ†é¡çµæœåˆ°ä¸»å…§å®¹å€
            function renderCategoryResults(results) {
                const container = document.getElementById('categoryResultsContainer');
                container.innerHTML = ''; // æ¸…ç©ºèˆŠçµæœ
    
                if (results.length > 0) {
                    results.forEach(key => {
                        const food = foodDatabase[key];
                        const card = document.createElement('div');
                        card.className = 'cursor-pointer bg-white p-4 rounded-lg shadow-md hover:shadow-xl hover:transform hover:-translate-y-1 transition-all';
                        
                        card.innerHTML = `
                            <div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center text-3xl mx-auto mb-3">${food.icon}</div>
                            <div class="text-center">
                                <div class="font-bold text-gray-800">${food.name}</div>
                                <div class="text-xs text-gray-500">${food.category}</div>
                            </div>
                        `;
                        
                        card.addEventListener('click', () => {
                            selectFood(key);
                            // åˆ‡æ›å›è©³æƒ…è¦–åœ–
                            document.getElementById('foodDetail').classList.remove('hidden');
                            container.classList.add('hidden');
                        });
                        container.appendChild(card);
                    });
                } else {
                    container.innerHTML = `<p class="text-center text-gray-500 col-span-full">æ­¤åˆ†é¡ä¸‹æ²’æœ‰é£Ÿç‰©ã€‚</p>`;
                }
            }
    
            function handlePortionClick(e) {
                document.querySelectorAll('.portion-btn').forEach(b => {
                    b.classList.remove('bg-white', 'text-green-700', 'shadow-sm');
                    b.classList.add('text-gray-500');
                });
                e.target.classList.remove('text-gray-500');
                e.target.classList.add('bg-white', 'text-green-700', 'shadow-sm');
                
                currentMultiplier = parseFloat(e.target.dataset.mult);
                updateNumbers();
            }
    
            function handleQuickSearchClick(e) {
                const key = e.currentTarget.dataset.food;
                selectFood(key);
                 // ç¢ºä¿è¦–åœ–æ­£ç¢º
                document.getElementById('foodDetail').classList.remove('hidden');
                document.getElementById('categoryResultsContainer').classList.add('hidden');
            }
    
            function handleSearch(query) {
                const searchResults = document.getElementById('searchResults');
                const foodDetail = document.getElementById('foodDetail');
                const categoryResultsContainer = document.getElementById('categoryResultsContainer');
    
                // ç•¶ä½¿ç”¨è€…é–‹å§‹æœå°‹æ™‚ï¼Œç¢ºä¿é¡¯ç¤ºé£Ÿç‰©è©³æƒ…ï¼Œéš±è—åˆ†é¡çµæœ
                foodDetail.classList.remove('hidden');
                categoryResultsContainer.classList.add('hidden');
    
                if (query.trim() === '') {
                    searchResults.classList.add('hidden');
                    return;
                }
    
                const results = Object.keys(foodDatabase).filter(key => {
                    const food = foodDatabase[key];
                    const name = food.name.toLowerCase();
                    const engName = food.engName.toLowerCase();
                    const q = query.toLowerCase();
                    // æ”¯æ´åŒç¾©è©æˆ–ç°¡å–®æ¨¡ç³Šæœå°‹
                    return name.includes(q) || engName.includes(q) || key.includes(q);
                });
    
                renderSearchResults(results, null);
            }
    
            // çµ±ä¸€æ¸²æŸ“æœå°‹çµæœåˆ—è¡¨
            function renderSearchResults(results, title) {
                const searchResults = document.getElementById('searchResults');
                searchResults.innerHTML = ''; 
    
                if (title) {
                    const titleEl = document.createElement('div');
                    titleEl.className = 'px-4 py-2 bg-gray-50 text-xs font-bold text-gray-500 uppercase tracking-wider sticky top-0';
                    titleEl.innerText = title;
                    searchResults.appendChild(titleEl);
                }
    
                if (results.length > 0) {
                    results.forEach(key => {
                        const food = foodDatabase[key];
                        const item = document.createElement('a');
                        item.href = '#';
                        item.className = 'flex items-center px-4 py-3 hover:bg-green-50 transition text-sm border-b border-gray-50 last:border-0';
                        
                        // å„ªåŒ–åˆ—è¡¨é¡¯ç¤º
                        item.innerHTML = `
                            <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-lg mr-3">${food.icon}</div>
                            <div>
                                <div class="font-medium text-gray-800">${food.name}</div>
                                <div class="text-xs text-gray-400">${food.engName}</div>
                            </div>
                        `;
                        
                        item.addEventListener('click', (e) => {
                            e.preventDefault();
                            selectFood(key);
                        });
                        searchResults.appendChild(item);
                    });
                    searchResults.classList.remove('hidden');
                } else {
                    const noResult = document.createElement('div');
                    noResult.className = 'px-4 py-8 text-center text-gray-400 text-sm';
                    noResult.innerHTML = '<i class="fa-regular fa-face-frown text-xl mb-2 block"></i> æ‰¾ä¸åˆ°ç›¸é—œé£Ÿç‰©';
                    searchResults.appendChild(noResult);
                    searchResults.classList.remove('hidden');
                }
            }
    
            function selectFood(key) {
                currentFoodKey = key;
                resetPortionUI();
                renderFood(key);
                
                // æ›´æ–° UI ç‹€æ…‹
                const searchInput = document.getElementById('searchInput');
                const searchResults = document.getElementById('searchResults');
                
                // ç¢ºä¿è©³æƒ…é é¡¯ç¤º
                document.getElementById('foodDetail').classList.remove('hidden');
                document.getElementById('categoryResultsContainer').classList.add('hidden');
                
                searchInput.value = foodDatabase[key].name; // å°‡é¸ä¸­çš„é£Ÿç‰©å¡«å…¥æœå°‹æ¡†
                searchInput.placeholder = "è©¦è©¦çœ‹ï¼šé…ªæ¢¨ã€é›èƒ¸è‚‰ã€é®­é­š..."; // é‡ç½® placeholder
                searchResults.classList.add('hidden');
            }
    
            function resetPortionUI() {
                currentMultiplier = 1;
                const btn100 = document.getElementById('btn-100g');
                btn100.click(); 
            }
    
            // æ¸²æŸ“é é¢ä¸»è¦æ•¸æ“š
            function renderFood(key) {
                const data = foodDatabase[key];
                if(!data) return;
    
                document.getElementById('foodName').innerText = `${data.name} (${data.engName})`;
                document.getElementById('foodIcon').innerText = data.icon;
                document.getElementById('foodCategory').innerText = data.category;
                document.getElementById('ai-summary').innerText = data.summary;
                document.getElementById('btn-serving').innerText = data.portionName;
                
                const servingMult = data.portionWeight / 100;
                document.getElementById('btn-serving').dataset.mult = servingMult;
    
                updateNumbers();
                updateChart(data);
            }
    
            // æ›´æ–°æ•¸å€¼èˆ‡é€²åº¦æ¢
            function updateNumbers() {
                const data = foodDatabase[currentFoodKey].base;
                const m = currentMultiplier; 
    
                const fmt = (num) => (num * m).toFixed(1).replace('.0', '');
    
                document.getElementById('caloriesDisplay').innerHTML = `${Math.round(data.calories * m)} <span class="text-base font-normal text-gray-500">kcal</span>`;
                document.getElementById('val-protein').innerText = `${fmt(data.protein)}g`;
                document.getElementById('val-fat').innerText = `${fmt(data.fat)}g`;
                document.getElementById('val-carbs').innerText = `${fmt(data.carbs)}g`;
                document.getElementById('val-k').innerText = `${Math.round(data.potassium * m)}mg`;
                document.getElementById('val-fiber').innerText = `${fmt(data.fiber)}g`;
    
                const pPct = Math.min((data.protein * m / 60) * 100, 100);
                const fPct = Math.min((data.fat * m / 60) * 100, 100);
                const cPct = Math.min((data.carbs * m / 300) * 100, 100);
    
                document.getElementById('bar-protein').style.width = `${pPct}%`;
                document.getElementById('bar-fat').style.width = `${fPct}%`;
                document.getElementById('bar-carbs').style.width = `${cPct}%`;
            }
    
            // Chart.js åœ–è¡¨è¨­å®š
            function updateChart(data) {
                const ctx = document.getElementById('nutritionRadar').getContext('2d');
                
                if(radarChart) radarChart.destroy();
    
                radarChart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['è›‹ç™½è³ª', 'è„‚è‚ª', 'ç¢³æ°´', 'çº–ç¶­', 'é‰€'],
                        datasets: [{
                            label: 'ç‡Ÿé¤Šç´ ä½”æ¯” (ç›¸å°æ–¼é«˜æ¨™)',
                            data: [
                                (data.base.protein / 30) * 100, 
                                (data.base.fat / 20) * 100, 
                                (data.base.carbs / 50) * 100,
                                (data.base.fiber / 10) * 100,
                                (data.base.potassium / 500) * 100
                            ],
                            backgroundColor: 'rgba(34, 197, 94, 0.2)',
                            borderColor: 'rgba(34, 197, 94, 1)',
                            pointBackgroundColor: 'rgba(34, 197, 94, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: { display: false },
                                grid: { color: '#e5e7eb' },
                                pointLabels: {
                                    font: {
                                        family: "'Noto Sans TC', sans-serif",
                                        size: 11
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: { display: false }
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            }
        </script>
        // ç‹€æ…‹ç®¡ç†
        let currentFoodKey = 'avocado';
        let currentMultiplier = 1;
        let radarChart = null;
        
        // --- 2. æ ¸å¿ƒåŠŸèƒ½å‡½æ•¸ ---

        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Header and Footer
            const headerContainer = document.getElementById("header-component");
            if (headerContainer && window.DeusHeaderComponent) {
              new window.DeusHeaderComponent(headerContainer).setDebug(false);
            }
            const footerContainer = document.getElementById("footer-component");
            if (footerContainer && window.DeusFooterComponent) {
              new window.DeusFooterComponent(footerContainer).setDebug(false);
            }

            // åˆå§‹åŒ–åˆ†é¡æŒ‰éˆ•
            generateCategoryButtons();
            
            // ç¶å®šå¿«é€Ÿæ¨™ç±¤äº‹ä»¶
            document.querySelectorAll('.quick-search-btn').forEach(btn => {
                btn.addEventListener('click', handleQuickSearchClick);
            });
            
            // é è¨­æ¸²æŸ“ç¬¬ä¸€ç­†é£Ÿç‰©
            const defaultFoodKey = Object.keys(foodDatabase)[0];
            currentFoodKey = defaultFoodKey;
            renderFood(currentFoodKey);
            
            // ç¶å®šä»½é‡æŒ‰éˆ•äº‹ä»¶
            document.querySelectorAll('.portion-btn').forEach(btn => {
                btn.addEventListener('click', handlePortionClick);
            });

            // ç¶å®šæœå°‹æ¡†äº‹ä»¶
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            
            searchInput.addEventListener('input', (e) => {
                handleSearch(e.target.value);
            });
            
            // é»æ“Šé é¢å…¶ä»–åœ°æ–¹æ™‚éš±è—æœå°‹çµæœ
            document.addEventListener('click', (e) => {
                // å¦‚æœé»æ“Šç›®æ¨™ä¸æ˜¯æœå°‹æ¡†ã€åˆ†é¡æŒ‰éˆ•æˆ–æœå°‹çµæœæœ¬èº«ï¼Œå‰‡é—œé–‰æœå°‹çµæœ
                if (!e.target.closest('#searchInput') && 
                    !e.target.closest('#categoryFilters') &&
                    !e.target.closest('#searchResults')) {
                    searchResults.classList.add('hidden');
                }
            });
        });

        // å‹•æ…‹ç”Ÿæˆåˆ†é¡æŒ‰éˆ•
        function generateCategoryButtons() {
            const container = document.getElementById('categoryFilters');
            const categories = [...new Set(Object.values(foodDatabase).map(item => item.category))];
            
            // Add 'All' button
            const allBtn = document.createElement('button');
            allBtn.className = 'px-3 py-1 rounded-full text-xs font-medium border border-green-500 bg-green-500 text-white transition shadow-sm';
            allBtn.innerText = 'å…¨éƒ¨';
            allBtn.addEventListener('click', () => {
                const allFoodKeys = Object.keys(foodDatabase);
                document.getElementById('foodDetail').classList.add('hidden');
                document.getElementById('categoryResultsContainer').classList.remove('hidden');
                renderCategoryResults(allFoodKeys);
                
                // Active state
                document.querySelectorAll('#categoryFilters button').forEach(b => b.classList.remove('bg-green-500', 'text-white'));
                allBtn.classList.add('bg-green-500', 'text-white');
            });
            container.appendChild(allBtn);

            categories.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'px-3 py-1 rounded-full text-xs font-medium border border-gray-300 bg-white text-gray-600 hover:bg-green-50 hover:text-green-700 hover:border-green-300 transition shadow-sm';
                btn.innerText = category;
                btn.addEventListener('click', (e) => {
                    filterByCategory(category);
                    
                    // Active state
                    document.querySelectorAll('#categoryFilters button').forEach(b => {
                        b.classList.remove('bg-green-500', 'text-white');
                        b.classList.add('bg-white', 'text-gray-600');
                    });
                    e.currentTarget.classList.add('bg-green-500', 'text-white');
                    e.currentTarget.classList.remove('bg-white', 'text-gray-600');
                });
                container.appendChild(btn);
            });
        }

        // ä¾åˆ†é¡ç¯©é¸åŠŸèƒ½
        function filterByCategory(category) {
            const searchInput = document.getElementById('searchInput');
            const foodDetail = document.getElementById('foodDetail');
            const categoryResultsContainer = document.getElementById('categoryResultsContainer');
            
            // æ¸…ç©ºæœå°‹æ¡†ï¼Œè®“ä½¿ç”¨è€…çŸ¥é“ç¾åœ¨æ˜¯åˆ†é¡ç€è¦½æ¨¡å¼
            searchInput.value = '';
            searchInput.placeholder = `æ­£åœ¨ç€è¦½ï¼š${category}`;

            // ç¯©é¸ç¬¦åˆè©²åˆ†é¡çš„é£Ÿç‰©
            const results = Object.keys(foodDatabase).filter(key => {
                return foodDatabase[key].category === category;
            });

            // éš±è—é£Ÿç‰©è©³æƒ…ï¼Œé¡¯ç¤ºåˆ†é¡çµæœ
            foodDetail.classList.add('hidden');
            categoryResultsContainer.classList.remove('hidden');

            renderCategoryResults(results);
        }

        // NEW: æ¸²æŸ“åˆ†é¡çµæœåˆ°ä¸»å…§å®¹å€
        function renderCategoryResults(results) {
            const container = document.getElementById('categoryResultsContainer');
            container.innerHTML = ''; // æ¸…ç©ºèˆŠçµæœ

            if (results.length > 0) {
                results.forEach(key => {
                    const food = foodDatabase[key];
                    const card = document.createElement('div');
                    card.className = 'cursor-pointer bg-white p-4 rounded-lg shadow-md hover:shadow-xl hover:transform hover:-translate-y-1 transition-all';
                    
                    card.innerHTML = `
                        <div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center text-3xl mx-auto mb-3">${food.icon}</div>
                        <div class="text-center">
                            <div class="font-bold text-gray-800">${food.name}</div>
                            <div class="text-xs text-gray-500">${food.category}</div>
                        </div>
                    `;
                    
                    card.addEventListener('click', () => {
                        selectFood(key);
                        // åˆ‡æ›å›è©³æƒ…è¦–åœ–
                        document.getElementById('foodDetail').classList.remove('hidden');
                        container.classList.add('hidden');
                    });
                    container.appendChild(card);
                });
            } else {
                container.innerHTML = `<p class="text-center text-gray-500 col-span-full">æ­¤åˆ†é¡ä¸‹æ²’æœ‰é£Ÿç‰©ã€‚</p>`;
            }
        }

        function handlePortionClick(e) {
            document.querySelectorAll('.portion-btn').forEach(b => {
                b.classList.remove('bg-white', 'text-green-700', 'shadow-sm');
                b.classList.add('text-gray-500');
            });
            e.target.classList.remove('text-gray-500');
            e.target.classList.add('bg-white', 'text-green-700', 'shadow-sm');
            
            currentMultiplier = parseFloat(e.target.dataset.mult);
            updateNumbers();
        }

        function handleQuickSearchClick(e) {
            const key = e.currentTarget.dataset.food;
            selectFood(key);
             // ç¢ºä¿è¦–åœ–æ­£ç¢º
            document.getElementById('foodDetail').classList.remove('hidden');
            document.getElementById('categoryResultsContainer').classList.add('hidden');
        }

        function handleSearch(query) {
            const searchResults = document.getElementById('searchResults');
            const foodDetail = document.getElementById('foodDetail');
            const categoryResultsContainer = document.getElementById('categoryResultsContainer');

            // ç•¶ä½¿ç”¨è€…é–‹å§‹æœå°‹æ™‚ï¼Œç¢ºä¿é¡¯ç¤ºé£Ÿç‰©è©³æƒ…ï¼Œéš±è—åˆ†é¡çµæœ
            foodDetail.classList.remove('hidden');
            categoryResultsContainer.classList.add('hidden');

            if (query.trim() === '') {
                searchResults.classList.add('hidden');
                return;
            }

            const results = Object.keys(foodDatabase).filter(key => {
                const food = foodDatabase[key];
                const name = food.name.toLowerCase();
                const engName = food.engName.toLowerCase();
                const q = query.toLowerCase();
                // æ”¯æ´åŒç¾©è©æˆ–ç°¡å–®æ¨¡ç³Šæœå°‹
                return name.includes(q) || engName.includes(q) || key.includes(q);
            });

            renderSearchResults(results, null);
        }

        // çµ±ä¸€æ¸²æŸ“æœå°‹çµæœåˆ—è¡¨
        function renderSearchResults(results, title) {
            const searchResults = document.getElementById('searchResults');
            searchResults.innerHTML = ''; 

            if (title) {
                const titleEl = document.createElement('div');
                titleEl.className = 'px-4 py-2 bg-gray-50 text-xs font-bold text-gray-500 uppercase tracking-wider sticky top-0';
                titleEl.innerText = title;
                searchResults.appendChild(titleEl);
            }

            if (results.length > 0) {
                results.forEach(key => {
                    const food = foodDatabase[key];
                    const item = document.createElement('a');
                    item.href = '#';
                    item.className = 'flex items-center px-4 py-3 hover:bg-green-50 transition text-sm border-b border-gray-50 last:border-0';
                    
                    // å„ªåŒ–åˆ—è¡¨é¡¯ç¤º
                    item.innerHTML = `
                        <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-lg mr-3">${food.icon}</div>
                        <div>
                            <div class="font-medium text-gray-800">${food.name}</div>
                            <div class="text-xs text-gray-400">${food.engName}</div>
                        </div>
                    `;
                    
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        selectFood(key);
                    });
                    searchResults.appendChild(item);
                });
                searchResults.classList.remove('hidden');
            } else {
                const noResult = document.createElement('div');
                noResult.className = 'px-4 py-8 text-center text-gray-400 text-sm';
                noResult.innerHTML = '<i class="fa-regular fa-face-frown text-xl mb-2 block"></i> æ‰¾ä¸åˆ°ç›¸é—œé£Ÿç‰©';
                searchResults.appendChild(noResult);
                searchResults.classList.remove('hidden');
            }
        }

        function selectFood(key) {
            currentFoodKey = key;
            resetPortionUI();
            renderFood(key);
            
            // æ›´æ–° UI ç‹€æ…‹
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            
            // ç¢ºä¿è©³æƒ…é é¡¯ç¤º
            document.getElementById('foodDetail').classList.remove('hidden');
            document.getElementById('categoryResultsContainer').classList.add('hidden');
            
            searchInput.value = foodDatabase[key].name; // å°‡é¸ä¸­çš„é£Ÿç‰©å¡«å…¥æœå°‹æ¡†
            searchInput.placeholder = "è©¦è©¦çœ‹ï¼šé…ªæ¢¨ã€é›èƒ¸è‚‰ã€é®­é­š..."; // é‡ç½® placeholder
            searchResults.classList.add('hidden');
        }

        function resetPortionUI() {
            currentMultiplier = 1;
            const btn100 = document.getElementById('btn-100g');
            btn100.click(); 
        }

        // æ¸²æŸ“é é¢ä¸»è¦æ•¸æ“š
        function renderFood(key) {
            const data = foodDatabase[key];
            if(!data) return;

            document.getElementById('foodName').innerText = `${data.name} (${data.engName})`;
            document.getElementById('foodIcon').innerText = data.icon;
            document.getElementById('foodCategory').innerText = data.category;
            document.getElementById('ai-summary').innerText = data.summary;
            document.getElementById('btn-serving').innerText = data.portionName;

            // æ›´æ–°ã€ŒæŸ¥çœ‹å®Œæ•´é é¢ã€é€£çµ
            const fullPageLink = document.getElementById('full-page-link');
            if (fullPageLink) {
                fullPageLink.href = `../food/${key}.html`;
            }
            
            const servingMult = data.portionWeight / 100;
            document.getElementById('btn-serving').dataset.mult = servingMult;

            updateNumbers();
            updateChart(data);
        }

        // æ›´æ–°æ•¸å€¼èˆ‡é€²åº¦æ¢
        function updateNumbers() {
            const data = foodDatabase[currentFoodKey].base;
            const m = currentMultiplier; 

            const fmt = (num) => (num * m).toFixed(1).replace('.0', '');

            document.getElementById('caloriesDisplay').innerHTML = `${Math.round(data.calories * m)} <span class="text-base font-normal text-gray-500">kcal</span>`;
            document.getElementById('val-protein').innerText = `${fmt(data.protein)}g`;
            document.getElementById('val-fat').innerText = `${fmt(data.fat)}g`;
            document.getElementById('val-carbs').innerText = `${fmt(data.carbs)}g`;
            document.getElementById('val-k').innerText = `${Math.round(data.potassium * m)}mg`;
            document.getElementById('val-fiber').innerText = `${fmt(data.fiber)}g`;

            const pPct = Math.min((data.protein * m / 60) * 100, 100);
            const fPct = Math.min((data.fat * m / 60) * 100, 100);
            const cPct = Math.min((data.carbs * m / 300) * 100, 100);

            document.getElementById('bar-protein').style.width = `${pPct}%`;
            document.getElementById('bar-fat').style.width = `${fPct}%`;
            document.getElementById('bar-carbs').style.width = `${cPct}%`;
        }

        // Chart.js åœ–è¡¨è¨­å®š
        function updateChart(data) {
            const ctx = document.getElementById('nutritionRadar').getContext('2d');
            
            if(radarChart) radarChart.destroy();

            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['è›‹ç™½è³ª', 'è„‚è‚ª', 'ç¢³æ°´', 'çº–ç¶­', 'é‰€'],
                    datasets: [{
                        label: 'ç‡Ÿé¤Šç´ ä½”æ¯” (ç›¸å°æ–¼é«˜æ¨™)',
                        data: [
                            (data.base.protein / 30) * 100, 
                            (data.base.fat / 20) * 100, 
                            (data.base.carbs / 50) * 100,
                            (data.base.fiber / 10) * 100,
                            (data.base.potassium / 500) * 100
                        ],
                        backgroundColor: 'rgba(34, 197, 94, 0.2)',
                        borderColor: 'rgba(34, 197, 94, 1)',
                        pointBackgroundColor: 'rgba(34, 197, 94, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { display: false },
                            grid: { color: '#e5e7eb' },
                            pointLabels: {
                                font: {
                                    family: "'Noto Sans TC', sans-serif",
                                    size: 11
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
    </script>