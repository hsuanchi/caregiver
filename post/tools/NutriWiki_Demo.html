<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¦–è¦ºåŒ–ç‡Ÿé¤Šç™¾ç§‘ | ç‡Ÿé¤Šç™¾ç§‘</title>
    
    <!-- å¼•å…¥ Tailwind CSS (å¿«é€Ÿæ’ç‰ˆèˆ‡ç¾åŒ–) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- å¼•å…¥ Chart.js (è³‡æ–™è¦–è¦ºåŒ–åœ–è¡¨) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- å¼•å…¥ Google Fonts (æå‡é–±è®€é«”é©—) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- å¼•å…¥ FontAwesome (åœ–ç¤º) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        /* è‡ªå®šç¾©éš±è—æ²è»¸ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Header Component Container -->
    <div id="header-component"></div>

    <!-- 2. æœå°‹èˆ‡ Hero å€å¡Š -->
    <header class="bg-green-600 text-white py-12 md:py-20 relative overflow-hidden">
        <div class="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10">
            <i class="fa-solid fa-carrot text-9xl"></i>
        </div>
        
        <div class="max-w-3xl mx-auto px-4 text-center relative z-10">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">å°‡æ•¸æ“šè½‰åŒ–ç‚ºæ‚¨çš„å¥åº·æ±ºç­–</h1>
            <p class="text-green-100 mb-8 text-lg">å…¨å°æœ€å¤§çš„è¦–è¦ºåŒ–ç‡Ÿé¤Šè³‡æ–™åº«ï¼Œè¼¸å…¥é£Ÿæç«‹å³æŸ¥è©¢ã€‚</p>
            
            <!-- æ¨¡æ“¬æœå°‹æ¡† -->
            <div class="relative max-w-lg mx-auto">
                <input type="text" id="searchInput" placeholder="è©¦è©¦çœ‹ï¼šé…ªæ¢¨ã€é›èƒ¸è‚‰ã€é®­é­š..." 
                    class="w-full pl-12 pr-4 py-4 rounded-full shadow-lg text-gray-800 focus:outline-none focus:ring-4 focus:ring-green-400 transition"
                    autocomplete="off">
                <i class="fa-solid fa-search absolute left-5 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                
                <!-- æœå°‹å»ºè­°ä¸‹æ‹‰é¸å–® (é è¨­éš±è—) -->
                <div id="searchResults" class="hidden absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-xl overflow-hidden text-left text-gray-800 border border-gray-100">
                    <!-- JS å‹•æ…‹ç”Ÿæˆçµæœ -->
                </div>
            </div>

            <!-- å¿«é€Ÿæ¨™ç±¤ -->
            <div class="mt-6 flex justify-center flex-wrap gap-2 text-sm">
                <button class="quick-search-btn bg-green-700 bg-opacity-50 hover:bg-opacity-70 px-4 py-1 rounded-full transition" data-food="avocado">ğŸ¥‘ é…ªæ¢¨</button>
                <button class="quick-search-btn bg-green-700 bg-opacity-50 hover:bg-opacity-70 px-4 py-1 rounded-full transition" data-food="chicken">ğŸ— é›èƒ¸è‚‰</button>
                <button class="quick-search-btn bg-green-700 bg-opacity-50 hover:bg-opacity-70 px-4 py-1 rounded-full transition" data-food="salmon">ğŸŸ é®­é­š</button>
            </div>
        </div>
    </header>

    <!-- 3. ä¸»è¦å…§å®¹å€ (Main Content) -->
    <main class="max-w-6xl mx-auto px-4 py-8">
        
        <!-- é£Ÿç‰©è©³æƒ…å¡ç‰‡ -->
        <div id="foodDetail" class="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden transition-all duration-300">
            
            <!-- æ¨™é¡Œèˆ‡ä»½é‡æ§åˆ¶å€ -->
            <div class="p-6 md:p-8 border-b border-gray-100 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div class="flex items-center gap-4">
                    <div id="foodIcon" class="w-16 h-16 rounded-2xl bg-green-100 flex items-center justify-center text-4xl shadow-inner">
                        ğŸ¥‘
                    </div>
                    <div>
                        <h2 id="foodName" class="text-3xl font-bold text-gray-800">é…ªæ¢¨ (Avocado)</h2>
                        <span id="foodCategory" class="text-sm text-green-600 bg-green-50 px-2 py-1 rounded-md font-medium">æ²¹è„‚èˆ‡å …æœç¨®å­é¡</span>
                    </div>
                </div>

                <!-- User Story: ä»½é‡æ›ç®—å™¨ -->
                <div class="bg-gray-100 p-1 rounded-lg flex text-sm font-medium">
                    <button class="portion-btn px-4 py-2 rounded-md shadow-sm bg-white text-green-700 transition" data-mult="1" id="btn-100g">100g (æ¨™æº–)</button>
                    <button class="portion-btn px-4 py-2 rounded-md text-gray-500 hover:text-gray-700 transition" data-mult="1.5" id="btn-serving">1 é¡† (å»ç±½ç´„ 150g)</button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-0 lg:gap-8">
                
                <!-- å·¦å´ï¼šæ ¸å¿ƒæ•¸æ“šèˆ‡åœ–è¡¨ -->
                <div class="lg:col-span-1 p-6 md:p-8 bg-gray-50 border-r border-gray-100">
                    <h3 class="text-lg font-bold text-gray-700 mb-6 flex items-center">
                        <i class="fa-solid fa-chart-pie mr-2 text-green-500"></i> ç‡Ÿé¤Šåˆ†ä½ˆé›·é”
                    </h3>
                    <div class="relative w-full aspect-square max-w-[300px] mx-auto">
                        <canvas id="nutritionRadar"></canvas>
                    </div>
                    <div class="mt-6 text-center">
                        <div class="text-4xl font-extrabold text-gray-800" id="caloriesDisplay">160 <span class="text-base font-normal text-gray-500">kcal</span></div>
                        <div class="text-sm text-gray-500">ç¸½ç†±é‡</div>
                    </div>
                </div>

                <!-- å³å´ï¼šè©³ç´°æ•¸æ“š (è³‡è¨Šåœ–è¡¨åŒ–) -->
                <div class="lg:col-span-2 p-6 md:p-8">
                    <h3 class="text-lg font-bold text-gray-700 mb-6 flex items-center">
                        <i class="fa-solid fa-list-check mr-2 text-green-500"></i> ç‡Ÿé¤Šç´ å„€è¡¨æ¿
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-8">
                        
                        <!-- å·¨é‡ç‡Ÿé¤Šç´  (Macro) -->
                        <div class="space-y-5">
                            <h4 class="text-sm font-semibold text-gray-400 uppercase tracking-wider">ä¸‰å¤§ç‡Ÿé¤Šç´ </h4>
                            
                            <!-- è›‹ç™½è³ª -->
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-700">è›‹ç™½è³ª (Protein)</span>
                                    <span class="text-sm font-bold text-gray-900" id="val-protein">2g</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5">
                                    <div id="bar-protein" class="bg-blue-500 h-2.5 rounded-full" style="width: 10%"></div>
                                </div>
                            </div>

                            <!-- è„‚è‚ª -->
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-700">ç¸½è„‚è‚ª (Fat)</span>
                                    <span class="text-sm font-bold text-gray-900" id="val-fat">14.7g</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5">
                                    <div id="bar-fat" class="bg-yellow-400 h-2.5 rounded-full" style="width: 70%"></div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1"><i class="fa-solid fa-circle-info text-blue-400"></i> å¯Œå«å–®å…ƒä¸é£½å’Œè„‚è‚ªé…¸ï¼Œå°å¿ƒè¡€ç®¡æœ‰ç›Šã€‚</p>
                            </div>

                            <!-- ç¢³æ°´åŒ–åˆç‰© -->
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-700">ç¢³æ°´åŒ–åˆç‰© (Carbs)</span>
                                    <span class="text-sm font-bold text-gray-900" id="val-carbs">8.5g</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5">
                                    <div id="bar-carbs" class="bg-green-500 h-2.5 rounded-full" style="width: 25%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- å¾®é‡ç‡Ÿé¤Šç´ èˆ‡ç‰¹å¾µ (Micro & Highlights) -->
                        <div class="space-y-5">
                            <h4 class="text-sm font-semibold text-gray-400 uppercase tracking-wider">é‡é»å¾®é‡å…ƒç´ </h4>
                            
                            <!-- é‰€ -->
                            <div class="flex items-center p-3 bg-blue-50 rounded-lg border border-blue-100">
                                <div class="p-2 bg-blue-100 rounded-full text-blue-600 mr-3">
                                    <i class="fa-solid fa-bolt"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="text-sm font-medium text-gray-600">é‰€ (Potassium)</div>
                                    <div class="text-lg font-bold text-gray-800" id="val-k">485mg</div>
                                </div>
                                <div class="text-xs font-bold text-white bg-blue-500 px-2 py-1 rounded">é«˜</div>
                            </div>

                            <!-- è†³é£Ÿçº–ç¶­ -->
                            <div class="flex items-center p-3 bg-green-50 rounded-lg border border-green-100">
                                <div class="p-2 bg-green-100 rounded-full text-green-600 mr-3">
                                    <i class="fa-solid fa-seedling"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="text-sm font-medium text-gray-600">è†³é£Ÿçº–ç¶­ (Fiber)</div>
                                    <div class="text-lg font-bold text-gray-800" id="val-fiber">6.7g</div>
                                </div>
                                <div class="text-xs font-bold text-white bg-green-500 px-2 py-1 rounded">å„ª</div>
                            </div>
                        </div>

                    </div>
                    
                    <!-- çµè«–/AI Summary -->
                    <div class="mt-8 bg-gray-800 text-white p-4 rounded-xl flex gap-3 items-start">
                        <i class="fa-solid fa-robot mt-1 text-green-400"></i>
                        <div>
                            <h5 class="font-bold text-sm text-green-400 mb-1">NutriBot çŸ­è©•ï¼š</h5>
                            <p class="text-sm leading-relaxed text-gray-300" id="ai-summary">
                                é€™æ˜¯éå¸¸å„ªè³ªçš„æ²¹è„‚ä¾†æºï¼é›–ç„¶ç†±é‡ç¨é«˜ï¼Œä½†å¯Œå«è†³é£Ÿçº–ç¶­èˆ‡é‰€é›¢å­ã€‚å»ºè­°æ­é…é›èƒ¸è‚‰é£Ÿç”¨ï¼Œé©åˆç”Ÿé…®é£²é£Ÿæˆ–å¢è‚Œæ¸›è„‚æ—ç¾¤ã€‚
                            </p>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </main>

    <!-- Footer Component Container -->
    <div id="footer-component"></div>

    <!-- Load Website Components -->
    <script src="../../assets/js/deus-header-component.js"></script>
    <script src="../../assets/js/deus-footer-component.js"></script>

    <!-- JavaScript é‚è¼¯å€ -->
    <script src="food_data.js"></script>
    <script>
        // --- è³‡æ–™åº«å·²å¾ food_data.js å¼•å…¥ ---

        // ç‹€æ…‹ç®¡ç†
        let currentFoodKey = 'avocado';
        let currentMultiplier = 1; // 1 = 100g, å…¶ä»–ç‚ºå€æ•¸
        let radarChart = null;
        
        // --- 2. æ ¸å¿ƒåŠŸèƒ½å‡½æ•¸ ---

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Header and Footer
            const headerContainer = document.getElementById("header-component");
            if (headerContainer && window.DeusHeaderComponent) {
              new window.DeusHeaderComponent(headerContainer).setDebug(false);
            }
            const footerContainer = document.getElementById("footer-component");
            if (footerContainer && window.DeusFooterComponent) {
              new window.DeusFooterComponent(footerContainer).setDebug(false);
            }

            // å‹•æ…‹ç”Ÿæˆå¿«é€Ÿæœå°‹æŒ‰éˆ•
            generateQuickSearchButtons();
            
            // é è¨­æ¸²æŸ“ç¬¬ä¸€ç­†é£Ÿç‰©
            const defaultFoodKey = Object.keys(foodDatabase)[0];
            currentFoodKey = defaultFoodKey;
            renderFood(currentFoodKey);
            
            // ç¶å®šä»½é‡æŒ‰éˆ•äº‹ä»¶
            document.querySelectorAll('.portion-btn').forEach(btn => {
                btn.addEventListener('click', handlePortionClick);
            });

            // ç¶å®šæœå°‹æ¡†äº‹ä»¶
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            
            searchInput.addEventListener('input', (e) => {
                handleSearch(e.target.value);
            });
            
            // é»æ“Šé é¢å…¶ä»–åœ°æ–¹æ™‚éš±è—æœå°‹çµæœ
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.relative')) {
                    searchResults.classList.add('hidden');
                }
            });
        });

        function generateQuickSearchButtons() {
            const container = document.querySelector('.mt-6.flex.justify-center');
            container.innerHTML = ''; // æ¸…ç©ºç¾æœ‰æŒ‰éˆ•
            const featuredKeys = ['avocado', 'chicken', 'salmon', 'sweet_potato']; // ç²¾é¸é …ç›®

            featuredKeys.forEach(key => {
                const food = foodDatabase[key];
                if (food) {
                    const button = document.createElement('button');
                    button.className = 'quick-search-btn bg-green-700 bg-opacity-50 hover:bg-opacity-70 px-4 py-1 rounded-full transition';
                    button.dataset.food = key;
                    button.innerHTML = `${food.icon} ${food.name}`;
                    button.addEventListener('click', handleQuickSearchClick);
                    container.appendChild(button);
                }
            });
        }
        
        function handlePortionClick(e) {
            // UI åˆ‡æ›
            document.querySelectorAll('.portion-btn').forEach(b => {
                b.classList.remove('bg-white', 'text-green-700', 'shadow-sm');
                b.classList.add('text-gray-500');
            });
            e.target.classList.remove('text-gray-500');
            e.target.classList.add('bg-white', 'text-green-700', 'shadow-sm');
            
            // é‚è¼¯é‹ç®—
            currentMultiplier = parseFloat(e.target.dataset.mult);
            updateNumbers();
        }

        function handleQuickSearchClick(e) {
            const key = e.currentTarget.dataset.food;
            currentFoodKey = key;
            resetPortionUI();
            renderFood(key);
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResults').classList.add('hidden');
        }

        function handleSearch(query) {
            const searchResults = document.getElementById('searchResults');
            if (query.trim() === '') {
                searchResults.classList.add('hidden');
                return;
            }

            const results = Object.keys(foodDatabase).filter(key => {
                const food = foodDatabase[key];
                const name = food.name.toLowerCase();
                const engName = food.engName.toLowerCase();
                const q = query.toLowerCase();
                return name.includes(q) || engName.includes(q);
            });

            searchResults.innerHTML = ''; // æ¸…ç©ºèˆŠçµæœ
            if (results.length > 0) {
                results.slice(0, 5).forEach(key => { // æœ€å¤šé¡¯ç¤º5ç­†
                    const food = foodDatabase[key];
                    const item = document.createElement('a');
                    item.href = '#';
                    item.className = 'block px-4 py-3 hover:bg-gray-100 transition text-sm';
                    item.innerHTML = `<span class="mr-2">${food.icon}</span> ${food.name} <span class="text-gray-400">(${food.engName})</span>`;
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        currentFoodKey = key;
                        resetPortionUI();
                        renderFood(key);
                        document.getElementById('searchInput').value = food.name;
                        searchResults.classList.add('hidden');
                    });
                    searchResults.appendChild(item);
                });
                searchResults.classList.remove('hidden');
            } else {
                const noResult = document.createElement('div');
                noResult.className = 'px-4 py-3 text-sm text-gray-500';
                noResult.innerText = 'æ‰¾ä¸åˆ°ç›¸ç¬¦çš„é£Ÿç‰©...';
                searchResults.appendChild(noResult);
                searchResults.classList.remove('hidden');
            }
        }

        function resetPortionUI() {
            currentMultiplier = 1;
            const btn100 = document.getElementById('btn-100g');
            const btnServing = document.getElementById('btn-serving');
            
            // é‡ç½®æŒ‰éˆ•æ¨£å¼
            btn100.click(); 
        }

        // æ¸²æŸ“é é¢ä¸»è¦æ•¸æ“š
        function renderFood(key) {
            const data = foodDatabase[key];
            if(!data) return;

            // æ›´æ–°æ–‡å­—èˆ‡åœ–ç¤º
            document.getElementById('foodName').innerText = `${data.name} (${data.engName})`;
            document.getElementById('foodIcon').innerText = data.icon;
            document.getElementById('foodCategory').innerText = data.category;
            document.getElementById('ai-summary').innerText = data.summary;
            
            // æ›´æ–°ä»½é‡æŒ‰éˆ•æ–‡å­—
            document.getElementById('btn-serving').innerText = data.portionName;
            
            // è¨ˆç®—ä»½é‡å€ç‡ (Serving weight / 100)
            const servingMult = data.portionWeight / 100;
            document.getElementById('btn-serving').dataset.mult = servingMult;

            updateNumbers();
            updateChart(data);
        }

        // æ›´æ–°æ•¸å€¼èˆ‡é€²åº¦æ¢ (User Story: ä»½é‡æ›ç®—)
        function updateNumbers() {
            const data = foodDatabase[currentFoodKey].base;
            const m = currentMultiplier; // Multiplier

            // Helper: æ ¼å¼åŒ–æ•¸å­— (å°æ•¸é»å¾Œ1ä½)
            const fmt = (num) => (num * m).toFixed(1).replace('.0', '');

            // æ›´æ–°æ•¸å€¼
            document.getElementById('caloriesDisplay').innerHTML = `${Math.round(data.calories * m)} <span class="text-base font-normal text-gray-500">kcal</span>`;
            document.getElementById('val-protein').innerText = `${fmt(data.protein)}g`;
            document.getElementById('val-fat').innerText = `${fmt(data.fat)}g`;
            document.getElementById('val-carbs').innerText = `${fmt(data.carbs)}g`;
            document.getElementById('val-k').innerText = `${Math.round(data.potassium * m)}mg`;
            document.getElementById('val-fiber').innerText = `${fmt(data.fiber)}g`;

            // æ›´æ–°é€²åº¦æ¢å¯¬åº¦ (è¦–è¦ºåŒ–)
            // å‡è¨­æ¯æ—¥åƒè€ƒå€¼: è›‹ç™½è³ª 60g, è„‚è‚ª 60g, ç¢³æ°´ 300g
            // é€™è£¡ç”¨ç°¡æ˜“é‚è¼¯ï¼šæ•¸å€¼ / åƒè€ƒå€¼ * 100ï¼Œæœ€é«˜ 100%
            const pPct = Math.min((data.protein * m / 60) * 100, 100);
            const fPct = Math.min((data.fat * m / 60) * 100, 100);
            const cPct = Math.min((data.carbs * m / 300) * 100, 100);

            document.getElementById('bar-protein').style.width = `${pPct}%`;
            document.getElementById('bar-fat').style.width = `${fPct}%`;
            document.getElementById('bar-carbs').style.width = `${cPct}%`;
        }

        // --- 3. Chart.js åœ–è¡¨è¨­å®š (User Story: è¦–è¦ºåŒ–å„€è¡¨æ¿) ---
        function updateChart(data) {
            const ctx = document.getElementById('nutritionRadar').getContext('2d');
            
            // éŠ·æ¯€èˆŠåœ–è¡¨ä»¥é¿å…é‡ç–Š
            if(radarChart) radarChart.destroy();

            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['è›‹ç™½è³ª', 'è„‚è‚ª', 'ç¢³æ°´', 'çº–ç¶­', 'é‰€'],
                    datasets: [{
                        label: 'ç‡Ÿé¤Šç´ ä½”æ¯” (ç›¸å°æ–¼é«˜æ¨™)',
                        data: [
                            // é€™è£¡ç‚ºäº†è®“é›·é”åœ–å¥½çœ‹ï¼Œåšäº†ä¸€äº›æ­£è¦åŒ–è™•ç† (éçµ•å°æ•¸å€¼)
                            (data.base.protein / 30) * 100, 
                            (data.base.fat / 20) * 100, 
                            (data.base.carbs / 50) * 100,
                            (data.base.fiber / 10) * 100,
                            (data.base.potassium / 500) * 100
                        ],
                        backgroundColor: 'rgba(34, 197, 94, 0.2)', // Tailwind Green-500
                        borderColor: 'rgba(34, 197, 94, 1)',
                        pointBackgroundColor: 'rgba(34, 197, 94, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { display: false }, // éš±è—åˆ»åº¦æ•¸å­—ï¼Œä¿æŒä»‹é¢ä¹¾æ·¨
                            grid: { color: '#e5e7eb' }
                        }
                    },
                    plugins: {
                        legend: { display: false } // éš±è—åœ–ä¾‹
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
    </script>
</body>
</html>
